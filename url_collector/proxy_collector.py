from bs4 import BeautifulSoup
from selenium import webdriver
from selenium.webdriver.support.ui import Select


def set_select(driver):
    """
    Set the select value of "www.syps.one/en/https-ssl-proxy/" to 500
    :param driver: Chrome driver for which setup is completed.
    """

    select = Select(driver.find_element_by_name("xpp"))
    select.select_by_visible_text('500')
    select = Select(driver.find_element_by_name("xpp"))
    select_option = select.first_selected_option.text
    if select_option != '500':
        set_select(driver)


def set_driver():
    """
    Set up the chrome driver.
    :return: Chrome driver for which setup is completed.
    :rtype:<class 'selenium.webdriver.chrome.webdriver.WebDriver'>
    """
    webdriver_options = webdriver.ChromeOptions()
    webdriver_options.add_argument('headless')
    webdriver_options.add_argument('disable-gpu')
    driver = webdriver.Chrome(executable_path='./chromedriver.exe', options=webdriver_options)
    driver.get(url='https://spys.one/en/https-ssl-proxy/')
    return driver


def get_proxy_list():
    """
    Gets the IP and address of the proxy.
    :return: The ip and address of the proxies
    :rtype: list
    """
    result = []
    trs = soup.select("tr[onmouseover]")
    for tr in trs:
        e_ip = tr.select_one("font.spy14")  # ip
        if e_ip is not None:
            for item in e_ip.findAll('script'):
                item.extract()
            ip = e_ip.text
        else:
            continue

        result.append(ip)
    return result


if __name__ == "__main__":
    chrome_driver = set_driver()
    print(type(chrome_driver))
    set_select(chrome_driver)
    html = chrome_driver.page_source
    soup = BeautifulSoup(html, 'html.parser')
    proxy_list = get_proxy_list()
    with open("proxy_list.txt", "w", encoding="utf-8") as f:
        f.writelines(f"{proxy}\n" for proxy in proxy_list)